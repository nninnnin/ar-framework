# AR Framework

<img width="730" height="374" alt="arframework-title" src="https://github.com/user-attachments/assets/9c2995cd-6c5b-432e-ab52-370e6ed79887" />

저는 크리에이티브 스튜디오 [**레벨나인(Rebel9)**](https://rebel9.co.kr)에서 여러가지 웹 기반 인터랙티브 프로젝트들의 개발에 참여하였습니다. 특히 AR 컨텐츠를 담은 모바일 웹 애플리케이션들을 다수 개발하였는데, 모바일 웹이라는 접근성 높은 인터페이스를 통해 오프라인 공간에 3D 모델 증강을 통한 새로운 시각적 경험을 제공하여 주로 지역의 특성을 제고시킬 수 있는 홍보 수단으로서 제작되었습니다

**AR Framework**는 반복적인 AR 컨텐츠 개발을 경험하며 쌓은 AR 컨텐츠 제작의 노하우를 하나의 템플릿에 모으고, UI 인터페이스를 통해 노코드 환경에서 AR 컨텐츠를 효율적으로 생산하고 편집하며, 완성된 컨텐츠와 외부 개발 환경의 연동을 간편하게 만들기 위한 인터페이스와 도구들의 묶음으로 만들어진 <b>컨텐츠 제작 프레임워크</b> 입니다.

(이 문장을 이해되기 쉽게 풀어서 설명하는 것이 아래에 나올 문단들의 역할이다. 시각적 요소로 말을 줄이고 시선을 끌고 흥미를 유발해 쉽게 이해되면서도 흥미로운 문서가 될 수 있도록 작성)

- Web AR 컨텐츠를 담은 모바일 웹 애플리케이션이 뭔지 그냥 사진이나 영상으로 바로 보여줘버리면서 시작하자.
  
- 다음으로는 그걸 어떻게, 왜 그렇게 만들었는지 모바일 웹 애플리케이션의 아키텍처가 꼭 설명되어야. 구조도로 그려주자

- 그리고 그렇게 만들면서 발생한 문제들에 대해 효과적으로 보여주는 에피소드랑 극적인 해결

<br/>

## 1. 개요

### 1.1. Web AR?

AR, 그중에서도 Web AR은 일반적으로 생소한 기술입니다. 안드로이드나 iOS의 네이티브 AR 기술(ARCore, ARKit)은 비교적 고도화된 개발이 가능한 상황이지만, 웹 브라우저의 기반으로 하는 AR 기술은 아직 표준화가 되지 않아 컨텐츠 개발이 쉽지 않은 상황입니다. 특히 크로스 브라우징을 지원하고 다양한 디바이스를 고려하게 되면 더더욱 그러한데요, 그럼에도 웹 브라우저에서 AR 컨텐츠 개발을 가능하게 하는 기술적 상황을 정리하자면 이렇습니다.

#### Web API
- `WebXR`: 현재 Web API를 통해 제공되는 AR 인터페이스인 `WebXR`은 안드로이드 크롬에서는 작동하지만, 사파리에서는 사용할 수 없습니다. 따라서 웹을 통해 제한되지 않은 사용자가 접속하는 환경의 컨텐츠 프로덕션에 적합하지 않습니다.

#### 유료 플랫폼
- `8thWall`: 모든 브라우저와 디바이스를 안정적으로 지원합니다. 자체 기술력으로 개발된 SLAM 방식(벽면이나 물체 표면을 인식해 증강)의 AR을 유일하게 제공합니다. 비용이 매우 높은 편입니다 (+2026년 기준, 서비스 종료 예정)

#### 오픈소스 라이브러리
- `AR.js`: 오픈소스 라이브러리 중 유일하게 **위치기반 AR** 기능을 제공합니다. 안드로이드 브라우저들과 사파리를 모두 지원합니다.
- `Mind.AR`: **얼굴인식 AR**과 **마커트래킹 AR**을 제공합니다. 안드로이드 브라우저들과 사파리를 모두 지원합니다.

### 1.3 기술적 선택: 오픈소스 라이브러리

당시 회사에서는 웹 브라우저를 기반으로 불특정 다수의 이용자들에게 서비스 가능한 AR 컨텐츠가 담긴 웹 애플리케이션을 납품 이후 유지보수 비용과 관리 포인트를 최소화하는 것이 목표였으므로, **무료** 임과 동시에 크로스 브라우징 대응이 가능한 오픈소스 라이브러리 두 가지를 사용하여, 총 세 가지 방식의 AR 컨텐츠를 제작할 수 있게 되었습니다.

<br/>

세 가지 방식의 AR 컨텐츠는 다음과 같습니다.

| Location Based | Face Tracking | Marker Tracking |
| :---: | :---: | :---: |
| <video src="https://github.com/user-attachments/assets/fc3eb4b0-7d76-4a40-9017-1e3a4bdd54aa" width="220" muted autoplay loop></video> | <video src="https://github.com/user-attachments/assets/3185a634-29e0-4138-b606-74a2494dc15b" width="220" muted autoplay loop></video> | <video src="https://github.com/user-attachments/assets/b94d14c0-444e-45f2-bcbc-c331f92d1fc1" width="220" muted autoplay loop></video> |
| 좌표를 입력하고, 디바이스에서 GPS와 방향정보를 가져와 위치를 계산하여 3D 모델을 증강 | 머신러닝으로 얼굴의 랜드마크(눈, 코, 귀, 머리)를 인식해 3D 모델을 증강 | 컴퓨터 비전 기술로 이미지 특징점을 인식해 마커 위에 모델을 증강 |

### 1.4. 아키텍처: AR 컨텐츠와 UI의 코드베이스 분리 및 런타임 통합

오픈소스로 제공되는 AR 라이브러리들은 Three.js기반의 a-frame과 cdn으로 제공되는 스크립트를 기반으로 작성된 예제를 제공합니다.  
이를 기반으로 제작된 AR 컨텐츠들은 HTML과 JavaScript 파일만을 담은 정적 프로젝트로 작성되어 배포하게 되었습니다.

그러나 AR 컨텐츠에서 3D 모델을 증강하고, 증강된 화면을 캡처하는 로직은 HTML/JavaScript로 충분했지만 5~6개의 컨텐츠를 담고 지도나 여러 페이지 및 인터랙션이 존재하는 UI를 구성하기 위해서는 리액트의 생산성이 필요했습니다. r3f와 같은 라이브러리를 사용하여 리액트쪽에 AR 컨텐츠를 통합하기보다는, AR은 그대로 라이프사이클과 개발방식을 유지하여 별개의 정적 컨텐츠로 배포하고, 리액트로 구성한 UI 프로젝트와 iframe을 사용해 통합하는 아키텍처를 떠올려 마이크로 프론트엔드 관점에서 각각의 프로젝트를 더 관심사 단위로 구분짓고 유지보수성을 높였습니다.

<br/>

## 2. 개발 배경

### 2.1. 반복적인 AR 컨텐츠의 개발과 제작 과정의 비효율

- **코드의 유지보수와 관련된 비효율**과
- **3D 모델과 관련된 컨텐츠 수정 워크플로우에서의 비효율**이 존재했습니다.

먼저 코드 유지보수 측면에서의 비효율은, 반복되는 코드를 매번 하드코딩으로 작성했다는 것입니다. 이 문제를 해결하기 위해 템플릿을 작성하고 이를 보일러플레이트로 활용하기 시작했지만, AR 개발을 반복적으로 진행하며 업그레이드되는 그래픽 퀄리티, 컬링, 라이브러리 버전에 따른 설정, 캡처에 사용되는 유틸리티 코드들을 이전 버전의 템플릿에서는 이용할 수 없다는 페인포인트가 존재했습니다.

다음으로 3D 모델과 관련된 워크플로우와 관련된 비효율입니다. 오프라인 환경에서 모바일을 통해 체험되는 Web AR 컨텐츠의 특성상, 기획자나 디자이너가 직접 현장에 가서 증강된 3D 모델의 크기, 색상, 위치등의 요소를 확인하고 수정해야한다는 제약이 존재합니다. 이러한 제약때문에 개발자가 함께 현장에서 노트북으로 코드를 편집하거나 유선 통화로 수치를 구두로 주고받으며 작업해야 했습니다.

(사진: 추운 겨울, 정릉에서 참새의 위치를 잡기 위해 노트북을 열고 편집해야 했습니다.)

### 1.5. 해결을 위한 시도

먼저 템플릿의 구성요소를 쪼개 모듈화했습니다.

### 1.6. 해결방안의 통합과 도구(Tool)화

## 2. 프로젝트 구조
