(()=>{class e{constructor(){let e=document.createElement("canvas");e.id="capture-canvas";let t=window.devicePixelRatio||1;this.dpr=t,e.width=window.innerWidth*t,e.height=window.innerHeight*t,e.style.width=`${window.innerWidth}px`,e.style.height=`${window.innerHeight}px`,this.canvas=e}getScene(){let e=document.querySelector("a-scene");if(!e)throw Error("No a-scene element found in the document");return e}getVideo(){let e=document.querySelector("video");if(!e)throw Error("No video element found in the document");return e}stopVideo(e){e.pause()}stopAnimatingScene(e){e.renderer.setAnimationLoop(null)}captureScene(e){return e.components.screenshot.getCanvas("perspective")}async drawScene(){let e=this.getScene(),t=this.captureScene(e);this.canvas.getContext("2d").drawImage(t,0,0,t.width,t.height,0,0,this.canvas.width,this.canvas.height)}drawVideo(){let e=this.getVideo();this.canvas.getContext("2d").drawImage(e,0,0,e.videoWidth,e.videoHeight,0,0,this.canvas.width,this.canvas.height)}resumeVideo(e){e.play()}resumeAnimatingScene(e){e.renderer.setAnimationLoop(()=>e.render())}capture(){this.stopAnimatingScene(this.getScene()),this.stopVideo(this.getVideo()),setTimeout(()=>{this.drawVideo(),this.drawScene(),this.exportAsBlob(e=>{this.resumeVideo(this.getVideo()),this.resumeAnimatingScene(this.getScene()),window.parent?.postMessage({type:"image-captured",payload:e},"*")})},3e3)}appendCanvasToBody(){document.body.appendChild(this.canvas)}removeCanvasFromBody(){document.body.removeChild(this.canvas)}exportAsBlob(e){return this.canvas.toBlob(t=>{e(t)},"image/png")}}let t=document.createElement("button");t.id="capture-button",t.addEventListener("click",()=>{new e().capture()}),document.body.appendChild(t)})();